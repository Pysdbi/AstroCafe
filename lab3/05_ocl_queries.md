# OCL-запросы

## Проверка модели через OCL-запросы

### 1. На какую сумму совершил покупок каждый из участников программы лояльности?

**OCL-выражение:**
```ocl
Участник_программы.allInstances->collect(
  'Совершено покупок на сумму: ' + 
  Карты.Операции->select(Тип_операции='покупка за деньги').Сумма->sum.asString + 
  ' (' + ФИО + ')'
)
```

**Результат:**
- Совершено покупок на сумму: 5000 (Иванов Иван Иванович)
- Совершено покупок на сумму: 3000 (Петров Петр Петрович)
- Совершено покупок на сумму: 7000 (Сидоров Сергей Сергеевич)

### 2. Кто из участников программы лояльности получил больше всего вознаграждений?

**OCL-выражение:**
```ocl
Участник_программы.allInstances->select(
  Вознаграждения->size = 
  Участник_программы.allInstances->collect(Вознаграждения->size)->maxValue
).ФИО
```

**Результат:**
Сидоров Сергей Сергеевич

### 3. По каким правилам можно получить вознаграждение «Бесплатный напиток»?

**OCL-выражение:**
```ocl
Вид_вознаграждения.allInstances->select(
  Название='Бесплатный напиток'
).Правила.Имя
```

**Результат:**
- Правило 1: Начисление за покупку
- Правило 2: Начисление по дате рождения

### 4. На какую сумму пополнил свой счет участник программы лояльности Сидоров за 2019 год?

**OCL-выражение:**
```ocl
Участник_программы.allInstances->select(
  ФИО.sqlLike('Сидоров %')
).Карты.Операции->select(
  (Дата.Year='2019') and (Тип_операции='пополнение')
).Сумма->sum
```

**Результат:**
10000

### 5. Когда было реализовано последнее вознаграждение бесплатный напиток каждым из участников?

**OCL-выражение:**
```ocl
Участник_программы.allInstances->collect(
  ФИО + ' реализовал вознаграждение за дату ' + 
  Вознаграждения->select(Использовано).Дата->last.asString
)
```

**Результат:**
- Иванов Иван Иванович реализовал вознаграждение за дату 20.12.2019
- Петров Петр Петрович реализовал вознаграждение за дату 10.10.2019
- Сидоров Сергей Сергеевич реализовал вознаграждение за дату 05.12.2019

### 6. Сколько фишек заработал каждый из участников за счет покупок, превышающих 1500 рублей?

**OCL-выражение:**
```ocl
Участник_программы.allInstances->collect(
  ФИО + ' получил ' + 
  (Карты.Операции->select(
    (Тип_операции='покупка за деньги') and (Сумма>1500)
  )->size*2).asString + 
  ' фишек'
)
```

**Результат:**
- Иванов Иван Иванович получил 4 фишки
- Петров Петр Петрович получил 2 фишки
- Сидоров Сергей Сергеевич получил 6 фишек

## Ограничения модели

### Ограничения для класса Участник программы

1. **ФИО не должно быть пустым**
```ocl
self.ФИО->notEmpty
```

2. **Участник программы должен быть совершеннолетним на момент регистрации**
```ocl
(self.Дата_регистрации.Year - self.Дата_рождения.Year) >= 18
```

3. **Электронный адрес должен быть корректным**
```ocl
self.email.regExpMatch('\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*')
```

4. **Пароль должен иметь не менее 6 символов**
```ocl
self.пароль.Length >= 6
```

### Ограничения для класса Правило

1. **Конечная дата периода действия правила должна превышать начальную дату**
```ocl
self.Конец_действия > self.Начало_действия
```

## Вычисляемые атрибуты

### Баланс карты
**Класс:** Карта лояльности

**OCL-выражение:**
```ocl
self.Операции->select(Тип_операции='пополнение').Сумма->sum - 
self.Операции->select(Тип_операции='покупка за деньги').Сумма->sum
```